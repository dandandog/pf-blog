<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml"
                xmlns:framework="http://java.sun.com/jsf/composite/components">
    <ui:define name="title">#{msg['blog']['resourceManagement']}</ui:define>

    <ui:define name="viewname">
        <li>#{msg['blog']['auth']}</li>
        <li>/</li>
        <li>#{msg['blog']['resourceManagement']}</li>
    </ui:define>
    <ui:define name="content">
        <div class="card">
            <h:form id="resource_form" prependId="false">
                <framework:treeTable id="resource" formDialogId="resource"
                                     headText="#{msg['blog']['resourceManagement']}"
                                     value="#{viewScope.rootTable}" editable="false"
                                     singleSelection="#{viewScope.sinSelected}"
                                     multipleSelection="#{viewScope.mulSelected}">

                    <p:ajax event="cellEdit" listener="#{controller.cellEdit}" global="false"
                            update="@widgetVar(resource_dataTable)"/>

                    <p:column headerText="#{msg['blog']['title']}" width="200">
                        <p:outputPanel layout="inline" style="vertical-align: middle;">
                            <i class="pi pi-#{element.icon} p-mr-2"/>
                            <h:outputText value="#{element.title}"/>
                        </p:outputPanel>
                    </p:column>

                    <p:column headerText="#{msg['blog']['seq']}" field="seq" filterable="false"
                              sortable="flase" width="60" responsivePriority="5">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{element.seq}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputNumber value="#{element.seq}" styleClass="ui-column-filter"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="#{msg['blog']['resourceType']}"
                              width="80" responsivePriority="4">
                        <framework:tags value="#{element.type}"/>
                    </p:column>

                    <p:column headerText="#{msg['blog']['display']}" field="display"
                              sortable="false"
                              filterable="false" width="60" responsivePriority="3">
                        <p:cellEditor>
                            <f:facet name="output">
                                <framework:tags value="#{element.display}" type="bool"/>
                            </f:facet>
                            <f:facet name="input">

                                <p:toggleSwitch value="#{element.display}"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column headerText="#{msg['blog']['path']}" responsivePriority="2">
                        <h:outputText value="#{element.path}"/>
                    </p:column>

                    <p:column headerText="#{msg['blog']['perms']}" responsivePriority="1">
                        <h:outputText value="#{element.perms}"/>
                    </p:column>
                </framework:treeTable>
            </h:form>
        </div>
    </ui:define>
    <ui:define name="dialog">
        <h:form id="dialogForm">
            <framework:dialog id="resource" value="#{viewScope.vo}" saveUpdate="@widgetVar(resource_treeTable)">
                <framework:label target="parent" value="#{msg['blog']['parent']}">
                    <p:tree id="parent" widgetVar="parent" value="#{viewScope.rootTree}"
                            style="max-height: 250px; overflow: auto"
                            var="node" datakey="#{node.id}" selection="#{viewScope.vo.parent}"
                            selectionMode="single">
                        <p:treeNode>
                            <h:outputText value="#{node.title}"/>
                        </p:treeNode>
                    </p:tree>
                </framework:label>

                <framework:label target="title" value="#{msg['blog']['title']}" styleClass="p-col-12 p-md-6"
                                 indicateRequired="true">
                    <div class="ui-inputgroup">
                        <p:commandButton widgetVar="iconBtn" id="iconBtn" immediate="true"
                                         icon="pi pi-#{viewScope.vo.icon}"/>
                        <p:overlayPanel widgetVar="iconPanel" for="iconBtn"
                                        style="width:500px; height: 500px; overflow-y: auto"
                                        dynamic="true">
                            <div id="icons-grid" class="p-grid p-ac-center">
                                <p:repeat value="#{viewScope.icons}" var="icon">
                                    <p:commandButton icon="pi pi-#{icon}" title="#{icon}" label="#{icon}"
                                                     update="@widgetVar(iconBtn)" process="@this"
                                                     oncomplete="PF('iconPanel').hide()"
                                                     styleClass="ui-button-secondary ui-button-flat p-col-12 p-md-2">
                                        <f:setPropertyActionListener value="#{icon}" target="#{viewScope.vo.icon}"/>
                                    </p:commandButton>
                                </p:repeat>
                            </div>
                        </p:overlayPanel>
                        <p:inputText id="title" value="#{viewScope.vo.title}" label="#{msg['blog']['title']}"
                                     required="true" title="#{msg['blog']['title']}"/>
                    </div>
                </framework:label>

                <framework:label target="resourceType" value="#{msg['blog']['resourceType']}"
                                 styleClass="p-col-12 p-md-6">
                    <p:selectOneRadio id="resourceType" widgetVar="type"
                                      value="#{viewScope.vo.type}" unselectable="false">
                        <f:selectItems value="#{viewScope.types}" var="type"
                                       itemLabel="#{type.title}" itemValue="#{type}"/>
                    </p:selectOneRadio>
                </framework:label>

                <framework:label widgetVar="target" target="target"
                                 value="#{msg['blog']['resourceTarget']}" styleClass="p-col-12 p-md-6">
                    <p:selectOneMenu id="target" value="#{viewScope.vo.target}" autoWidth="true">
                        <f:selectItems value="#{viewScope.targets}" var="target"
                                       itemLabel="#{target.title}" itemValue="#{target}"/>
                    </p:selectOneMenu>
                </framework:label>

                <framework:label widgetVar="perms" target="perms"
                                 value="#{msg['blog']['perms']}" styleClass="p-col-12 p-md-6">
                    <p:inputText id="perms" value="#{viewScope.vo.perms}" required="true"/>
                </framework:label>

                <framework:label widgetVar="path" target="path" value="#{msg['blog']['path']}">
                    <p:inputText id="path" value="#{viewScope.vo.path}"/>
                </framework:label>
            </framework:dialog>
        </h:form>
    </ui:define>
</ui:composition>