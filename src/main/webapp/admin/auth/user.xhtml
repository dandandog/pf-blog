<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml"
                xmlns:framework="http://java.sun.com/jsf/composite/components">
    <ui:define name="title">#{msg['blog']['userManage']}</ui:define>
    <ui:define name="viewname">
        <li>#{msg['blog']['auth']}</li>
        <li>/</li>
        <li>#{msg['blog']['userManage']}</li>
    </ui:define>
    <ui:define name="content">
        <h:form id="user_form" prependId="false">
            <p:outputPanel styleClass="p-grid p-nogutter">
                <p:outputPanel id="resource_menu_panel" styleClass="p-col-12 p-md-2">
                    <p:toolbar>
                        <p:toolbarGroup>
                            <p:inputText/>
                        </p:toolbarGroup>
                    </p:toolbar>
                    <p:dataTable value="#{viewScope.roles}" var="element">
                        <p:column headerText="角色">

                            <h:outputText value="#{element.name}"/>

                        </p:column>
                    </p:dataTable>
                </p:outputPanel>
                <p:outputPanel styleClass="p-col-12 p-md-10">
                    <framework:dataTable id="user" formDialogId="user" lazy="true"
                                         headText="#{msg['blog']['userManagement']}" addSupported="false"
                                         value="#{controller.dataModel}"
                                         singleSelection="#{viewScope.sinSelected}"
                                         multipleSelection="#{viewScope.mulSelected}">

                        <p:column headerText="#{msg['blog']['nickname']}" field="nickname"
                                  filterMatchMode="contains">
                            <framework:avatar user="#{element}"/>
                        </p:column>
                        <p:column headerText="#{msg['blog']['userType']}"
                                  field="type" filterMatchMode="equals">
                            <f:facet name="filter">
                                <p:selectOneMenu onchange="PF('user_dataTable').filter()"
                                                 converter="#{userTypeConverter}"
                                                 styleClass="ui-column-filter">
                                    <f:selectItem itemLabel="#{msg['framework']['all']}" itemValue="#{null}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{viewScope.types}" var="type"
                                                   itemLabel="#{type.title}"
                                                   itemValue="#{type}"/>
                                </p:selectOneMenu>
                            </f:facet>
                            <h:outputText value="#{element.type.title}"/>
                        </p:column>
                        <p:column headerText="#{msg['blog']['userState']}"
                                  field="state" filterMatchMode="equals">
                            <f:facet name="filter">
                                <p:selectOneMenu onchange="PF('user_dataTable').filter()"
                                                 converter="#{userStateConverter}"
                                                 styleClass="ui-column-filter">
                                    <f:selectItem itemLabel="#{msg['framework']['all']}" itemValue="#{null}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{viewScope.states}" var="state"
                                                   itemLabel="#{state.title}"
                                                   itemValue="#{state}"/>
                                </p:selectOneMenu>
                            </f:facet>
                            <framework:tags value="#{element.state}"/>
                        </p:column>
                        <p:column headerText="#{msg['blog']['userGender']}"
                                  field="gender" filterMatchMode="equals">
                            <f:facet name="filter">
                                <p:selectOneMenu onchange="PF('user_dataTable').filter()"
                                                 converter="#{userGenderConverter}"
                                                 styleClass="ui-column-filter">
                                    <f:selectItem itemLabel="#{msg['framework']['all']}" itemValue="#{null}"
                                                  noSelectionOption="true"/>
                                    <f:selectItems value="#{viewScope.genders}" var="gender"
                                                   itemLabel="#{gender.title}"
                                                   itemValue="#{gender}"/>
                                </p:selectOneMenu>
                            </f:facet>
                            <framework:tags value="#{element.gender}"/>
                        </p:column>
                        <p:column headerText="#{msg['blog']['phone']}" field="phone" filterMatchMode="contains"/>
                        <p:column headerText="#{msg['blog']['email']}" field="email" filterMatchMode="contains"/>
                        <p:column headerText="#{msg['framework']['operatedTime']}" sortBy="operatedTime"
                                  sortable="true" width="150"
                                  sortOrder="desc" sortPriority="1">
                            <h:outputText value="#{element.operatedTime}">
                                <f:convertDateTime type="localDateTime"
                                                   pattern="#{msg['format']['localDateTime']}"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="#{msg['blog']['remark']}" field="remark" filterable="false"
                                  sortable="false"/>
                    </framework:dataTable>
                </p:outputPanel>
            </p:outputPanel>
        </h:form>
    </ui:define>

    <ui:define name="dialog">
        <h:form id="dialogform">
            <framework:dialog id="user" value="#{viewScope.vo}"
                              saveUpdate="@widgetVar(user_dataTable)">
                <framework:label target="avatar" value="#{msg['blog']['avatar']}" styleClass="p-col-12">
                    <framework:upload id="avatar" value="#{viewScope.vo.avatarUrl}"/>
                </framework:label>
                <framework:label target="nickname" value="#{msg['blog']['nickname']}" styleClass="p-col-6">
                    <p:inputText id="nickname" value="#{viewScope.vo.nickname}"/>
                </framework:label>
                <framework:label target="gender" value="#{msg['blog']['userGender']}" styleClass="p-col-6">
                    <p:selectOneMenu id="gender" value="#{viewScope.vo.gender}">
                        <f:selectItems value="#{viewScope.genders}" var="gender"
                                       itemLabel="#{gender.title}" itemValue="#{gender}"/>
                    </p:selectOneMenu>
                </framework:label>
                <framework:label target="mobile" value="#{msg['blog']['phone']}" styleClass="p-col-6">
                    <p:inputMask id="mobile" value="#{viewScope.vo.phone}" mask="999-999-99999"/>
                </framework:label>

                <framework:label target="email" value="#{msg['blog']['email']}" styleClass="p-col-6">
                    <p:inputText id="email" value="#{viewScope.vo.email}"/>
                </framework:label>

                <framework:label target="remark" value="#{msg['blog']['remark']}">
                    <p:inputTextarea id="remark" value="#{viewScope.vo.remark}" autoResize="false"/>
                </framework:label>

            </framework:dialog>
        </h:form>
    </ui:define>
</ui:composition>