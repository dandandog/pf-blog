<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:framework="http://java.sun.com/jsf/composite/components"
                template="/WEB-INF/template.xhtml">
    <ui:define name="title">#{msg['blog']['dictManage']}</ui:define>
    <ui:define name="head">

        <h:outputStylesheet>
            .rootTree {
                height: calc(100vh - 350px);
            }

            @media (max-width: 760px) {
                .rootTree {
                    height: auto;
                }
            }
        </h:outputStylesheet>

    </ui:define>
    <ui:define name="viewname">
        <li>#{msg['blog']['config']}</li>
        <li>/</li>
        <li>#{msg['blog']['dictManage']}</li>
    </ui:define>
    <ui:define name="content">
        <h:form id="dict_form" prependId="false">
            <p:outputPanel styleClass="p-grid">
                <p:outputPanel styleClass="p-col-12 p-md-2">
                    <p:tree widgetVar="dict_tree" value="#{viewScope.rootTree}" var="node" selectionMode="single"
                            selection="#{viewScope.selectedNode}" filterBy="#{node.name}"
                            styleClass="rootTree">
                        <p:ajax event="select" listener="#{controller.onSelect}" process="@this"
                                update="@widgetVar(dict_dataTable)"/>
                        <p:treeNode>
                            <h:outputText value="#{node.name}"/>
                        </p:treeNode>
                    </p:tree>
                    <p:commandButton value="#{msg['framework']['add']}" icon="pi pi-plus" style="width: 100%"
                                     action="#{controller.addNode}" update="@widgetVar(dict_node_dialog)"
                                     oncomplete="PF('dict_node_dialog').show()"/>
                </p:outputPanel>

                <p:outputPanel styleClass="p-col-12 p-md-10">
                    <framework:dataTable id="dict" formDialogId="dict"
                                         headText="#{msg['blog']['dictManagement']}"
                                         value="#{viewScope.list}"
                                         singleSelection="#{viewScope.sinSelected}"
                                         multipleSelection="#{viewScope.mulSelected}">
                        <p:ajax event="cellEdit" listener="#{controller.cellEdit}" global="false"
                                update="@widgetVar(dict_dataTable)"/>

                        <p:column headerText="#{msg['blog']['seq']}" width="80"
                                  field="seq" filterable="false" filterMatchMode="equals">
                            <p:cellEditor>
                                <f:facet name="output">
                                    <h:outputText value="#{element.seq}"/>
                                </f:facet>
                                <f:facet name="input">
                                    <p:inputNumber value="#{element.seq}" styleClass="ui-column-filter"/>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="#{msg['blog']['label']}" width="200"
                                  field="label" filterable="false" filterMatchMode="equals"/>
                        <p:column headerText="#{msg['blog']['value']}" width="100" responsivePriority="2"
                                  field="value" filterable="false" filterMatchMode="equals"/>
                        <p:column headerText="#{msg['blog']['inputType']}" width="80" responsivePriority="3"
                                  field="type" filterable="false" filterMatchMode="contains"/>
                        <p:column headerText="#{msg['blog']['remark']}" responsivePriority="4"
                                  field="remark" filterable="false" filterMatchMode="contains"/>
                    </framework:dataTable>
                </p:outputPanel>
            </p:outputPanel>
        </h:form>
    </ui:define>

    <ui:define name="dialog">
        <h:form id="node_form">
            <framework:dialog id="dict_node" value="#{viewScope.node}" saveMethod="#{controller.saveNode}"
                              saveUpdate="@widgetVar(dict_tree)">

                <p:tree widgetVar="dict_tree" value="#{viewScope.inputTree}" var="node" selectionMode="single"
                        selection="#{viewScope.node.parent}" filterBy="#{node.name}">
                    <p:treeNode>
                        <h:outputText value="#{node.name}"/>
                    </p:treeNode>
                </p:tree>

                <framework:label target="name" value="#{msg['blog']['name']}" styleClass="p-col-6 node-input">
                    <p:inputText id="name" value="#{viewScope.node.name}" required="true"/>
                </framework:label>
                <framework:label target="code" value="#{msg['blog']['code']}" styleClass="p-col-6  node-input">
                    <p:inputText id="code" value="#{viewScope.node.code}" required="true"/>
                </framework:label>
                <framework:label target="remark" value="#{msg['blog']['remark']}" styleClass="p-col-12 node-input">
                    <p:inputTextarea id="remark" value="#{viewScope.vo.node.remark}" autoResize="false"/>
                </framework:label>


            </framework:dialog>
        </h:form>

        <h:form id="dialogform">
            <framework:dialog id="dict" value="#{viewScope.vo}"
                              saveUpdate="@widgetVar(dict_dataTable)">
                <framework:label target="label" value="#{msg['blog']['label']}" indicateRequired="true"
                                 styleClass="p-col-6">
                    <div class="ui-inputgroup">
                        <p:selectBooleanButton id="def" value="#{viewScope.vo.req}"
                                               onLabel="#{msg['blog']['reqYes']}"
                                               offLabel="#{msg['blog']['reqNo']}"
                                               style="width:90px"/>
                        <p:inputText id="label" value="#{viewScope.vo.label}" label="#{msg['blog']['label']}"
                                     required="true"/>
                    </div>
                </framework:label>
                <framework:label target="value" value="#{msg['blog']['code']}" styleClass="p-col-6">
                    <p:inputText id="value" value="#{viewScope.vo.code}"/>
                </framework:label>

                <framework:label target="inputType" value="#{msg['blog']['inputType']}" styleClass="p-col-6">
                    <p:selectOneMenu id="inputType" value="#{viewScope.vo.type}" required="true"
                                     converter="#{inputTypeConverter}">
                        <f:selectItems value="#{viewScope.types}" var="type"
                                       itemLabel="#{type.title}" itemValue="#{type}"/>
                    </p:selectOneMenu>
                </framework:label>

                <framework:label value="#{msg['blog']['value']}" styleClass="p-col-12">
                    <p:chips value="#{viewScope.vo.value}" converter="#{inputItemConverter}" styleClass="value-chips"/>
                </framework:label>

                <framework:label target="valueRemark" value="#{msg['blog']['remark']}">
                    <p:inputTextarea id="valueRemark" value="#{viewScope.vo.remark}"/>
                </framework:label>

            </framework:dialog>
        </h:form>
    </ui:define>
</ui:composition>